<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
<meta name="description" content="{% if page.description %}{{ page.description }}{% elsif page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">

<!-- SEO Tags -->
{% seo %}

<!-- Google Fonts - Real ShokaX Font Stack with Performance Optimization -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;600;700&family=Fredericka+the+Great&family=Noto+Serif+JP:wght@400;700&family=Noto+Serif+SC:wght@400;700&family=Inconsolata:wght@400;700&display=swap" rel="stylesheet">
<style>
  /* Critical CSS - Font Loading Optimization */
  @font-face {
    font-family: 'Mulish';
    font-display: swap;
  }
  @font-face {
    font-family: 'Fredericka the Great';
    font-display: swap;
  }
  @font-face {
    font-family: 'Noto Serif JP';
    font-display: swap;
  }
  @font-face {
    font-family: 'Noto Serif SC';
    font-display: swap;
  }
  @font-face {
    font-family: 'Inconsolata';
    font-display: swap;
  }
</style>

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- ShokaX Custom Icon Font -->
<link rel="stylesheet" href="//at.alicdn.com/t/c/font_4415496_59g1326wajd.css">

<!-- CSS Files -->
<link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">

<!-- Code Highlighting - Prism.js -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css">

<!-- Math Support - MathJax -->
<script>
window.MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    packages: ['base', 'ams', 'autoload', 'color', 'configmacros']
  },
  options: {
    enableMenu: false,
    renderActions: {
      findScript: [10, function (doc) {
        for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
          const display = !!node.type.match(/; *mode=display/);
          const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
          const text = document.createTextNode(math.root.toTeX());
          node.parentNode.replaceChild(text, node);
        }
      }, '']
    }
  },
  startup: {
    pageReady: () => {
      return MathJax.startup.defaultPageReady().then(() => {
        // Add copy functionality to math expressions
        document.querySelectorAll('.MathJax').forEach(math => {
          math.addEventListener('click', () => {
            const tex = math.querySelector('[data-mml-node="math"]')?.getAttribute('data-tex');
            if (tex && navigator.clipboard) {
              navigator.clipboard.writeText(tex);
            }
          });
        });
      });
    }
  }
};
</script>
<script async src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<!-- Favicon -->
{% if site.logo %}
<link rel="icon" type="image/png" href="{{ site.logo | relative_url }}">
{% endif %}

<!-- Enhanced SEO & Open Graph -->
<meta property="og:type" content="{% if page.date %}article{% else %}website{% endif %}">
<meta property="og:title" content="{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}">
<meta property="og:description" content="{% if page.description %}{{ page.description }}{% elsif page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
<meta property="og:url" content="{{ page.url | absolute_url }}">
<meta property="og:site_name" content="{{ site.title }}">
{% if page.header.teaser or page.image %}
<meta property="og:image" content="{{ page.header.teaser | default: page.image | absolute_url }}">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:alt" content="{{ page.title | default: site.title }}">
{% endif %}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}">
<meta name="twitter:description" content="{% if page.description %}{{ page.description }}{% elsif page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
{% if page.header.teaser or page.image %}
<meta name="twitter:image" content="{{ page.header.teaser | default: page.image | absolute_url }}">
{% endif %}

<!-- Additional SEO -->
<meta name="robots" content="index, follow">
<meta name="googlebot" content="index, follow">
<link rel="canonical" href="{{ page.url | absolute_url }}">
{% if page.date %}
<meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">
<meta property="article:modified_time" content="{% if page.last_modified_at %}{{ page.last_modified_at | date_to_xmlschema }}{% else %}{{ page.date | date_to_xmlschema }}{% endif %}">
{% if page.author %}<meta property="article:author" content="{{ page.author }}">{% endif %}
{% for tag in page.tags %}<meta property="article:tag" content="{{ tag }}">{% endfor %}
{% endif %}

<!-- Structured Data - JSON-LD -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{% if page.date %}BlogPosting{% else %}WebPage{% endif %}",
  "headline": "{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title | escape }}{% endif %}",
  "description": "{% if page.description %}{{ page.description | escape }}{% elsif page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 | escape }}{% else %}{{ site.description | escape }}{% endif %}",
  "url": "{{ page.url | absolute_url }}",
  {% if page.date %}
  "datePublished": "{{ page.date | date_to_xmlschema }}",
  "dateModified": "{% if page.last_modified_at %}{{ page.last_modified_at | date_to_xmlschema }}{% else %}{{ page.date | date_to_xmlschema }}{% endif %}",
  {% endif %}
  {% if page.header.teaser or page.image %}
  "image": {
    "@type": "ImageObject",
    "url": "{{ page.header.teaser | default: page.image | absolute_url }}",
    "width": 1200,
    "height": 630
  },
  {% endif %}
  "author": {
    "@type": "Person",
    "name": "{{ site.author.name | default: site.title }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ site.title }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ site.logo | default: '/assets/images/logo.png' | absolute_url }}"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ page.url | absolute_url }}"
  }
}
</script>

<!-- Analytics -->
{% if site.analytics %}
  {% include analytics.html %}
{% endif %}